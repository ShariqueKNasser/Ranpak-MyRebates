sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/format/NumberFormat","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,s,r,a,o){"use strict";return e.extend("ranpak.wz.rebatelist.controller.BaseController",{getAppModulePath:function(){var e=jQuery.sap.getModulePath("ranpak.wz.rebatelist");return e},fetchDate:function(e){const t=e.getTimezoneOffset()*6e4;const s=new Date(e.getTime()-t);return s},validateNumberFld:function(e){var t=false;var s=e.getSource().getValue();var r=/^\d+$/;if(r.test(s)){t=true}return t},validateAlphaNumFld:function(e){var t=false;var s=e.getSource().getValue();var r=/^[\w\-\s]+$/;if(r.test(s)){t=true}return t},validateNumFldBlk:function(e){var t="";var s=/^\d+$/;if(e){if(s.test(e)){t=e;this.setValueState("None")}else{this.setValueState("Error")}}else{this.setValueState("None")}return t},validateAlphaNumFldBlk:function(e){var t="";var s=/^[\w\-\s]+$/;if(e){if(s.test(e)){t=e;this.setValueState("None")}else{this.setValueState("Error")}}else{this.setValueState("None")}if(this.getBindingContext("oBlkUpldMdl")){this.getBindingContext("oBlkUpldMdl").getObject()[this.getBindingInfo("value").parts[0].path]=t}return t},validateAmntFldBlk:function(e){var s="";var r=t.getCurrencyInstance({currencyCode:false,decimals:2});var a=/^\d+$/;if(e){var o=r.parse(e);if(o){e=r.parse(e)[0]}if(a.test(e)){s=e;s=r.format(e);this.setValueState("None")}else{this.setValueState("Error")}}else{this.setValueState("None")}if(this.getBindingContext("oBlkUpldMdl")){this.getBindingContext("oBlkUpldMdl").getObject()[this.getBindingInfo("value").parts[0].path]=s}return s},validateDateFldBlk:function(e){var t=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYY/MM/dd"});var s="";var r=isNaN(Date.parse(e));if(!r){s=e;s=t.format(new Date(s));this.setValueState("None")}else{this.setValueState("Error")}if(this.getBindingContext("oBlkUpldMdl")){this.getBindingContext("oBlkUpldMdl").getObject()[this.getBindingInfo("value").parts[0].path]=s}return s},validateBlkPayload:function(){this.oErrFlds=[];var e=true;var t=this.getView().byId("idBlkUpldTbl");var s=t.getRows();var r="",a="";for(var o=0;o<s.length;o++){r=s[o].getCells();a=s[o].getBindingContext("oBlkUpldMdl");if(a){for(var i=0;i<r.length;i++){if(r[i].getValueState()==="Error"){e=false;this.oErrFlds.push(r[i].getBindingInfo("value").parts[0].path+" in Line "+(o+1))}}}}return e},formBlkClmPayload:function(){var e=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYY-MM-dd"});var t=[];var s="";var r=this.getOwnerComponent().getModel("oBlkUpldMdl");var a=r.getData();var o=a.columns;var i=a.rows;for(var n=0;n<i.length;n++){s=Object.keys(i[n]);var l={},u="",m;for(var d=0;d<s.length;d++){if(s[d]==="Ranpak Rebate ID #"){m=10-i[n][s[d]].length;for(var c=0;c<m;c++){u+="0"}u+=i[n][s[d]];l["Rebate_ID"]=u}else if(s[d]==="Sales Organization"){l["Sales_Organization"]=i[n][s[d]]}else if(s[d]==="Ranpak Distributor Number"){l["Distributor_No"]=i[n][s[d]]}else if(s[d]==="Distributor Name"){l["Distributor_Name"]=i[n][s[d]]}else if(s[d]==="Ranpak End User Number"){l["End_User_No"]=i[n][s[d]]}else if(s[d]==="End user Name"){l["End_user_Name"]=i[n][s[d]]}else if(s[d]==="End User City"){l["End_User_City"]=i[n][s[d]]}else if(s[d]==="End user State"){l["End_user_State"]=i[n][s[d]]}else if(s[d]==="Your Sales Office #"){l["Your_Sales_Office"]=i[n][s[d]]}else if(s[d]==="Your Sales Office Name"){l["Your_Sales_Office_Name"]=i[n][s[d]]}else if(s[d]==="Your Item #"){l["Your_Item"]=i[n][s[d]]}else if(s[d]==="Your Item Description"){l["Your_Item_Description"]=i[n][s[d]]}else if(s[d]==="Ranpak Item #"){l["Ranpak_Item"]=i[n][s[d]]}else if(s[d]==="End User Invoice #"){l["End_User_Invoice"]=i[n][s[d]]}else if(s[d]==="End User Invoice Date (YYYY-MM-DD)"){l["End_User_Ship_Date"]=e.format(new Date(i[n][s[d]]))}else if(s[d]==="Resale Price"){l["Resale_Price"]=i[n][s[d]]}else if(s[d]==='"List Price "'){l["List_Price"]=i[n][s[d]]}else if(s[d]==="Rebate Amount â‚¬"){l["Rebate_Amount"]=i[n][s[d]]}else if(s[d]==="Net Price"){l["Net_Price"]=i[n][s[d]]}else if(s[d]==="Qty Sold to End User"){l["Quantity"]=i[n][s[d]]}else if(s[d]==="UOM Sold"){l["UOM"]=i[n][s[d]]}else if(s[d]==="customer reference"){l["Customer_Reference"]=i[n][s[d]]}l["col16"]="";l["col17"]=""}t.push(l)}var f={file_name:"REBATE_CLAIM",dummytoexcelset:t,dummytomessageset:[]};return f},onBlkSubmit:function(){var e=this.validateBlkPayload();if(e){this.triggerRebateClmSubmit(true)}else{var t="";for(var s=0;s<this.oErrFlds.length;s++){t+="\n"+(s+1)+". "+this.oErrFlds[s]}r.error(this.oI18n.getText("VALIDATE_PAYLOAD_ERR")+",\n"+t)}},resetAttachMdl:function(){var e=this.getOwnerComponent().getModel("oAttachmentMdl");e.setProperty("/results",[]);e.refresh(true)},onPostResponseOpen:function(){var e=this.getView();var t=this;if(!this.byId("idPostResponseDlg")){a.load({id:e.getId(),name:"ranpak.wz.rebatelist.fragment.postResponse",controller:this}).then(function(s){e.addDependent(s);s.open();t.oBusyDialog.close()})}else{this.byId("idPostResponseDlg").open();this.oBusyDialog.close()}},onPostRespnsClose:function(){this.byId("idPostResponseDlg").close();if(this.oFileUploaded){this.oFileUploaded=false;this.onFilterClear()}},hndlPostSuccess:function(e){var t={};var s=e.Rebate_ID;if(s.charAt(0)===","){s=s.substring(1)}var r=s.split(",");t["message"]="Rebate credit note "+e.Message_Value+" has been submitted for processing";t["msgType"]=e.Message_Type;t["creditNoteNum"]=e.Message_Value;t["rebateID"]=r;t["invoiceNum"]=e.End_User_Invoice;t["shipDate"]=e.End_User_Ship_Date;this.oFinalMsgArr.push(t);var a=this.getOwnerComponent().getModel("oPOSTResponseMdl");a.setProperty("/results",this.oFinalMsgArr);a.refresh(true)},hndlPostErrWarn:function(e){var t={};t["message"]=e.Messages;t["msgType"]=e.Message_Type;t["creditNoteNum"]=e.Message_Value;t["rebateID"]=e.Rebate_ID;t["invoiceNum"]=e.End_User_Invoice;t["shipDate"]=e.End_User_Ship_Date;this.oFinalMsgArr.push(t);var s=this.getOwnerComponent().getModel("oPOSTResponseMdl");s.setProperty("/results",this.oFinalMsgArr);s.refresh(true)},formClmPayload:function(){var e=[];var t="",s;for(var r=0;r<this.oClmSbmsnDt.length;r++){t="";s=10-this.oClmSbmsnDt[r].RebateID.length;for(var a=0;a<s;a++){t+="0"}t+=this.oClmSbmsnDt[r].RebateID;e.push({Rebate_ID:t,Sales_Organization:"",Distributor_No:this.oClmSbmsnDt[r].CustomerID,Distributor_Name:this.oClmSbmsnDt[r].CustomerDescription,End_User_No:this.oClmSbmsnDt[r].EndUserID,End_user_Name:this.oClmSbmsnDt[r].EndUserDescription,End_User_City:"",End_user_State:"",Your_Sales_Office:"",Your_Sales_Office_Name:"",Your_Item:"",Your_Item_Description:"",Ranpak_Item:this.oClmSbmsnDt[r].MaterialID,End_User_Invoice:this.oClmSbmsnDt[r].End_User_Invoice,End_User_Ship_Date:this.oClmSbmsnDt[r].End_User_Ship_Date,col16:"",col17:"",Resale_Price:"",List_Price:this.oClmSbmsnDt[r].ListPrice,Rebate_Amount:this.oClmSbmsnDt[r].RebateAmount,Net_Price:this.oClmSbmsnDt[r].NetPrice,Quantity:this.oClmSbmsnDt[r].Quantity,UOM:this.oClmSbmsnDt[r].Unit,Customer_Reference:""})}var o={file_name:"REBATE_CLAIM",dummytoexcelset:e,dummytomessageset:[]};return o},triggerRebateClmSubmit:function(e){this.oBusyDialog.open();var t=this;var s="";if(e){s=this.formBlkClmPayload()}else{s=this.formClmPayload()}var a=this.getOwnerComponent().getModel("oPOSTMdl");a.create("/dummyheaderSet",s,{success:function(r){t.oFinalMsgArr=[];var a=r.dummytomessageset.results;var o="",i="",n="",l="",u=0;for(var m=0;m<a.length;m++){i=a[m].Message_Type;o=a[m].Messages;if(i==="S"){u=1;t.hndlPostSuccess(a[m])}else if(i==="E"||i==="W"){t.hndlPostErrWarn(a[m])}}if(u===1){t.upldDocToSharePoint(e,s)}else{t.onPostResponseOpen()}},error:function(e){t.oBusyDialog.close();var s=JSON.parse(e.responseText);r.error(s.error.message.value)}})},upldDocToSharePoint:function(e,t){this.oBusyDialog.open();var s=this;var a=[],o=[],i="";var n=this.getOwnerComponent().getModel("oAttachmentMdl");var l=n.getProperty("/results");for(var u=0;u<l.length;u++){o.push({name:l[u].fileName,content:l[u].b64Content})}for(var u=0;u<this.oFinalMsgArr.length;u++){if(this.oFinalMsgArr[u].msgType==="S"){a.push({rebateClaimNo:this.oFinalMsgArr[u].creditNoteNum,docs:o})}}var m={};if(e){m={customerId:t.dummytoexcelset[0].Distributor_No,customerName:t.dummytoexcelset[0].Distributor_Name,RebateClaims:a}}else{m={customerId:this.oClmSbmsnDt[0].CustomerID,customerName:this.oClmSbmsnDt[0].CustomerDescription,RebateClaims:a}}var d=this.getOwnerComponent().getModel();d.create("/UploadDocuments",m,{success:function(e){if(s.byId("idAttachmentDlg")){s.byId("idAttachmentDlg").close()}if(s.byId("idBlkRbtClmDlg")){s.byId("idBlkRbtClmDlg").close()}s.oBusyDialog.close();s.oFileUploaded=true;s.onPostResponseOpen()},error:function(e){if(s.byId("idAttachmentDlg")){s.byId("idAttachmentDlg").close()}s.oBusyDialog.close();var t=JSON.parse(e.responseText);var a=t.error.message.value+". "+s.oI18n.getText("TRY_AGAIN");r.error(oFinalMsg+"\n"+a)}})},onSuccInfoPress:function(e){var t=e.getSource().getBindingContext("oPOSTResponseMdl").getObject();var s=new o;s.setProperty("/rebateID",t.rebateID);s.refresh(true);var r=e.getSource();var a=new sap.m.List;var i=new sap.m.StandardListItem({title:{path:"",formatter:function(e){return e.replace(/^0+/,"")}}});a.bindAggregation("items","/rebateID",i);var n=new sap.m.Popover({title:"for "+this.oI18n.getText("columnRebateID"),content:[a]});n.setModel(s);n.openBy(r)}})});
//# sourceMappingURL=BaseController.js.map