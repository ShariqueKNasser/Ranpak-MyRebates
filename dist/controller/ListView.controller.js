sap.ui.define(["ranpak/wz/rebatelist/controller/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Token"],function(e,t,r,a){"use strict";return e.extend("ranpak.wz.rebatelist.controller.ListView",{onInit:function(){var e=this.getOwnerComponent();this._router=e.getRouter();this._router.getRoute("ListView").attachPatternMatched(this._handleRouteMatched,this)},_handleRouteMatched:function(e){this.oI18n=this.getView().getModel("i18n").getResourceBundle();this.oFiltrKeys=["RebateID","ValidTo","CustomerID","EndUserID","MaterialID","Status"];const t=function(e){const t=e.text;return new a({key:t,text:t})};this.byId("inputRebateID").addValidator(t)},onFilterClear:function(e){var t=this.getView().byId("idMyRebatesFB");var r="";for(var a=0;a<this.oFiltrKeys.length;a++){r=t.getControlByKey(this.oFiltrKeys[a]);if(this.oFiltrKeys[a]==="RebateID"){r.setTokens([])}else if(this.oFiltrKeys[a]==="ValidTo"){r.setValue(null)}else if(this.oFiltrKeys[a]==="Status"){r.setSelectedKey(null)}else{r.setSelectedKeys([])}}t.fireSearch()},onBeforeRebindTbl:function(e){var s=this.getView().byId("idMyRebatesFB");var o=e.getParameter("bindingParams");var i=o.parameters.select;i+=",MaterialDescription,EndUserDescription,CustomerDescription,Currency";o.parameters.select=i;var n=s.getAllFiltersWithValues();for(var l=0;l<n.length;l++){this.formFiltersForTable(o,s,n[l])}const u=new sap.ui.core.routing.HashChanger;let c=u.getHash();if(c){c=c.split("SearchString=")[1];if(!c){return}const e=new t("RebateID",r.Contains,c);const s=new t("CustomerDescription",r.Contains,c);const i=new t("CustomerID",r.Contains,c);const n=new t([e,s,i],false);o.filters.push(n);this.byId("inputRebateID").setTokens([new a({key:c,text:c})])}},formFiltersForTable:function(e,t,r){var a=r.getName();var s=t.getControlByKey(a);var o="",i="";switch(a){case"RebateID":o=s.getTokens();i=this.formMultiFiltrMdl(o,"RebateID",true);break;case"CustomerID":o=s.getSelectedKeys();i=this.formMultiFiltrMdl(o,"CustomerID",true);break;case"ValidTo":o=s.getDateValue();i=this.formMultiFiltrMdl(o,"ValidTo",false,s);break;case"EndUserID":o=s.getSelectedKeys();i=this.formMultiFiltrMdl(o,"EndUserID",true);break;case"MaterialID":o=s.getSelectedKeys();i=this.formMultiFiltrMdl(o,"MaterialID",true);break;case"Status":o=s.getSelectedKey();i=this.formMultiFiltrMdl(o,"Status",false);break;default:break}e.filters.push(i)},formMultiFiltrMdl:function(e,r,a,s){var o=[],i="",n="",l="",u="EQ";if(a){for(var c=0;c<e.length;c++){if(r==="RebateID"){u="EQ";n=e[c].getText()}else{n=e[c].toUpperCase()}}}else{if(r==="ValidTo"){u="BT";n=this.fetchDate(s.getDateValue());l=new Date(s.getSecondDateValue().getFullYear(),s.getSecondDateValue().getMonth()+1,0);l=this.fetchDate(l)}else if(r==="Status"){n=e}}i=new t({path:r,operator:u,value1:n,value2:l});o.push(i);return new t(o)},onBeforeVariantFetch:function(e){var t=this.getView().byId("idMyRebatesFB");var r=[];var a=t.getControlByKey("RebateID").getTokens();for(var s=0;s<a.length;s++){r.push(a[s].getText())}t.setFilterData({_CUSTOM:{RebateID:r,ValidTo:t.getControlByKey("ValidTo").getValue(),CustomerID:t.getControlByKey("CustomerID").getSelectedKeys(),EndUserID:t.getControlByKey("EndUserID").getSelectedKeys(),MaterialID:t.getControlByKey("MaterialID").getSelectedKeys(),Status:t.getControlByKey("Status").getSelectedKey()}})},onVariantLoad:function(e){var t=this.getView().byId("idMyRebatesFB");var r=t.getFilterData();var s=r["_CUSTOM"];var o=[];for(var i=0;i<s.RebateID.length;i++){o.push(new a({key:s.RebateID[i],text:s.RebateID[i]}));t.getControlByKey("RebateID").setTokens(o)}t.getControlByKey("CustomerID").setSelectedKeys(s.CustomerID);t.getControlByKey("EndUserID").setSelectedKeys(s.EndUserID);t.getControlByKey("MaterialID").setSelectedKeys(s.MaterialID);t.getControlByKey("ValidTo").setValue(s.ValidTo);t.getControlByKey("Status").setSelectedKey(s.Status)},onMyRebatesExport:function(e){var t="";t="My_Rebates_"+(new Date).toISOString();e.getParameter("exportSettings").fileName=t;this.formatExportList(e)},formatExportList:function(e){var t=e.getParameter("exportSettings").workbook;var r=t.columns;t.context={sheetName:"My Rebates"};for(var a=0;a<r.length;a++){switch(r[a].label){case this.oI18n.getText("columnCustomer"):r[a].property=["CustomerDescription","CustomerID"];r[a].template="{0} ({1})";break;case this.oI18n.getText("columnRebateID"):r[a].property="RebateID";break;case this.oI18n.getText("columnEndUser"):r[a].property=["EndUserDescription","EndUserID"];r[a].template="{0} ({1})";break;case this.oI18n.getText("columnMaterial"):r[a].property=["MaterialDescription","MaterialID"];r[a].template="{0} ({1})";break;case this.oI18n.getText("columnUnit"):r[a].property="Unit";break;case this.oI18n.getText("columnListPrice"):r[a].property="ListPrice";break;case this.oI18n.getText("columnRebateAmount"):r[a].property="RebateAmount";break;case this.oI18n.getText("columnNetPrice"):r[a].property="NetPrice";break;case this.oI18n.getText("columnValidFrom"):r[a].type=sap.ui.export.EdmType.Date;r[a].property="ValidFrom";r[a].format="YYYY/MM/dd";break;case this.oI18n.getText("columnValidTo"):r[a].type=sap.ui.export.EdmType.Date;r[a].property="ValidTo";r[a].format="YYYY/MM/dd";break;case this.oI18n.getText("columnStatus"):r[a].property="Status";break;case this.oI18n.getText("columnEndUserPrice"):r[a].property="EndUserPrice";break;default:break}}},GetStatusState:function(e){const t=this.getOwnerComponent().getModel("i18n").getResourceBundle();if(e===t.getText("filterStatusActive")){return"Success"}if(e===t.getText("filterStatusExpired")){return"Error"}}})});
//# sourceMappingURL=ListView.controller.js.map